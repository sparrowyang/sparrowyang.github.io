<!DOCTYPE html>
<html lang="zh-cn">

<head>
  <meta charset="utf-8">

<meta name="viewport" content="width=device-width, initial-scale=1.0">


  
    <meta name="description" content="动态库的构建 编写库 fun.h:
void info(); fun.c:
#include &#34;fun.h&#34; int main(int argc, char const *argv[]) { info(); return 0; } 编译 gcc -fPIC -shared fun.c -o libfun123.so 使用 main.c:
#include &#34;fun.h&#34;int main(int argc, char const *argv[]) { info(); return 0; } gcc main.c libfun123.so -o app.out 此时检查编译的可执行文件：
➞ ldd app.out linux-vdso.so.1 (0x00007fffdbbee000) libfun123.so =&gt; not found libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f2f3e5a9000) /lib64/ld-linux-x86-64.so.2 (0x00007f2f3e7cf000) 发现找不到动态库，我们将库需要加入到库目录中。
export LD_LIBRARY_PATH=${LD_LIBRARY_PATH}:/mnt/d/workspace/codeblock/temp/share 此时找到了
➞ ldd app.out linux-vdso.so.1 (0x00007ffcfcf96000) libfun123.">
  








<meta name="generator" content="Hugo 0.68.3" />
  <title>c语言动态库 | Sparrooow log</title>
  <link rel="canonical" href="/post/1/">


  








  
    
  
  
  <link rel="stylesheet" href="/css/base.min.23cd48cee155498cf8a6f89152dd9fda2bd56047a4845068f7927636fd0c454f.css" integrity="sha256-I81IzuFVSYz4pviRUt2f2ivVYEekhFBo95J2Nv0MRU8=" crossorigin="anonymous">



</head>

<body>
  <nav class="u-background">
  <div class="u-wrapper">
    <ul class="Banner">
      <li class="Banner-item Banner-item--title">
        <a class="Banner-link u-clickable" href="/">Sparrooow log</a>
      </li>
      
        <li class="Banner-item">
          <a class="Banner-link u-clickable" href="/about/">About</a>
        </li>
      
        <li class="Banner-item">
          <a class="Banner-link u-clickable" href="/post/">Posts</a>
        </li>
      
        <li class="Banner-item">
          <a class="Banner-link u-clickable" href="/tags/">Tags</a>
        </li>
      
        <li class="Banner-item">
          <a class="Banner-link u-clickable" href="/categories/">Categories</a>
        </li>
      
        <li class="Banner-item">
          <a class="Banner-link u-clickable" href="/index.xml">RSS</a>
        </li>
      
    </ul>
  </div>
</nav>
  <main>
    <div class="u-wrapper">
      <div class="u-padding">
        

  <article>
    <header class="Heading">
  <h2 class="Heading-title">
    <a class="Heading-link u-clickable" href="/post/1/" rel="bookmark">c语言动态库</a>
  </h2>
  
    <time datetime="2021-05-22T00:00:00Z">22 May, 2021</time>
  
</header>
    <h1 id="动态库的构建">动态库的构建</h1>
<h2 id="编写库">编写库</h2>
<p><code>fun.h</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">info</span>();
</code></pre></div><p><code>fun.c</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;fun.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#66d9ef">const</span> <span style="color:#f92672">*</span>argv[])
{
    info();
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}
</code></pre></div><h2 id="编译">编译</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">gcc -fPIC -shared fun.c -o libfun123.so
</code></pre></div><h2 id="使用">使用</h2>
<p><code>main.c</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;fun.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#66d9ef">const</span> <span style="color:#f92672">*</span>argv[])
{
    info();
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">gcc main.c libfun123.so -o app.out
</code></pre></div><p>此时检查编译的可执行文件：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">➞  ldd app.out
        linux-vdso.so.1 <span style="color:#f92672">(</span>0x00007fffdbbee000<span style="color:#f92672">)</span>
        libfun123.so <span style="color:#f92672">=</span>&gt; not found
        libc.so.6 <span style="color:#f92672">=</span>&gt; /lib/x86_64-linux-gnu/libc.so.6 <span style="color:#f92672">(</span>0x00007f2f3e5a9000<span style="color:#f92672">)</span>
        /lib64/ld-linux-x86-64.so.2 <span style="color:#f92672">(</span>0x00007f2f3e7cf000<span style="color:#f92672">)</span>
</code></pre></div><p>发现找不到动态库，我们将库需要加入到库目录中。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">export LD_LIBRARY_PATH<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>LD_LIBRARY_PATH<span style="color:#e6db74">}</span>:/mnt/d/workspace/codeblock/temp/share

</code></pre></div><p>此时找到了</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">➞  ldd app.out
        linux-vdso.so.1 <span style="color:#f92672">(</span>0x00007ffcfcf96000<span style="color:#f92672">)</span>
        libfun123.so <span style="color:#f92672">=</span>&gt; /mnt/d/workspace/codeblock/temp/share/libfun123.so <span style="color:#f92672">(</span>0x00007fcdd8cb7000<span style="color:#f92672">)</span>
        libc.so.6 <span style="color:#f92672">=</span>&gt; /lib/x86_64-linux-gnu/libc.so.6 <span style="color:#f92672">(</span>0x00007fcdd8a98000<span style="color:#f92672">)</span>
        /lib64/ld-linux-x86-64.so.2 <span style="color:#f92672">(</span>0x00007fcdd8cc3000<span style="color:#f92672">)</span>
</code></pre></div><p>运行：</p>
<pre><code>➞  ./app.out
you know me!% 
</code></pre>
    


  

  





    
  

  </article>


      </div>
    </div>
  </main>
  
  <footer class="Footer">
    <div class="u-wrapper">
      <div class="u-padding">
        Except where otherwise noted, content on this site is licensed under a &#32; <a href="http://creativecommons.org/licenses/by/4.0/" rel="license">Creative Commons Attribution 4.0 International License</a>.
      </div>
    </div>
  </footer>

</body>

</html>
